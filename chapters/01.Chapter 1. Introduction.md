# فصل 1. مقدمه

## 1.1. چگونه یک سیستم LFS بسازیم

سیستم LFS با استفاده از یک توزیع لینوکس از قبل نصب شده (مانند Debian، OpenMandriva، Fedora یا openSUSE) ساخته خواهد شد. این سیستم لینوکس موجود (میزبان) به عنوان نقطه شروع برای ارائه برنامه‌های ضروری، از جمله کامپایلر، لینکر و شل، برای ساخت سیستم جدید استفاده خواهد شد. گزینه "توسعه" را هنگام نصب توزیع انتخاب کنید تا این ابزارها را شامل شود.

```Text
**نکته**: راه‌های زیادی برای نصب یک توزیع لینوکس وجود دارد و تنظیمات پیش‌فرض معمولاً برای ساخت یک سیستم LFS بهینه نیستند. برای پیشنهاداتی در مورد تنظیم یک توزیع تجاری، به این آدرس مراجعه کنید: https://www.linuxfromscratch.org/hints/downloads/files/partitioning-for-lfs.txt
```

به عنوان جایگزینی برای نصب یک توزیع جداگانه روی دستگاه خود، ممکن است بخواهید از یک LiveCD از یک توزیع تجاری استفاده کنید.

فصل 2 این کتاب توضیح می‌دهد که چگونه یک پارتیشن و سیستم فایل جدید لینوکس بومی ایجاد کنیم، جایی که سیستم جدید LFS کامپایل و نصب خواهد شد. فصل 3 توضیح می‌دهد که کدام بسته‌ها و پچ‌ها باید برای ساخت یک سیستم LFS دانلود شوند و چگونه آنها را در سیستم فایل جدید ذخیره کنیم. فصل 4 درباره تنظیم یک محیط کاری مناسب بحث می‌کند. لطفاً فصل 4 را با دقت بخوانید زیرا چندین مسئله مهم را توضیح می‌دهد که باید قبل از شروع کار در فصل 5 و بعد از آن از آنها آگاه باشید.

فصل 5 نصب زنجیره ابزار اولیه (binutils، gcc و glibc) را با استفاده از تکنیک‌های کامپایل متقاطع برای جدا کردن ابزارهای جدید از سیستم میزبان توضیح می‌دهد.

فصل 6 نشان می‌دهد که چگونه ابزارهای پایه را با استفاده از زنجیره ابزار متقاطع تازه ساخته شده، کامپایل متقاطع کنیم.

فصل 7 سپس وارد یک محیط "chroot" می‌شود، جایی که ما از ابزارهای جدید برای ساخت تمام ابزارهای دیگر مورد نیاز برای ایجاد سیستم LFS استفاده می‌کنیم.

این تلاش برای جدا کردن سیستم جدید از توزیع میزبان ممکن است بیش از حد به نظر برسد. یک توضیح فنی کامل در مورد اینکه چرا این کار انجام می‌شود در "یادداشت‌های فنی زنجیره ابزار" ارائه شده است.

در فصل 8 سیستم کامل LFS ساخته می‌شود. مزیت دیگری که توسط محیط chroot ارائه می‌شود این است که به شما اجازه می‌دهد در حالی که LFS در حال ساخت است، به استفاده از سیستم میزبان ادامه دهید. در حالی که منتظر تکمیل کامپایل بسته‌ها هستید، می‌توانید به استفاده معمول از کامپیوتر خود ادامه دهید.

برای اتمام نصب، پیکربندی پایه سیستم در فصل 9 تنظیم می‌شود و هسته و بارگذار بوت در فصل 10 ایجاد می‌شوند. فصل 11 شامل اطلاعاتی درباره ادامه تجربه LFS فراتر از این کتاب است. پس از اجرای مراحل این فصل، کامپیوتر آماده بوت شدن به سیستم جدید LFS است.

این فرآیند به طور خلاصه است. اطلاعات دقیق درباره هر مرحله در فصل‌های بعدی ارائه شده است. مواردی که اکنون پیچیده به نظر می‌رسند روشن خواهند شد و همه چیز در جای خود قرار خواهد گرفت زمانی که ماجراجویی LFS خود را آغاز کنید.


### ۱.۲ چه چیزهایی از نسخه قبلی تغییر کرده است؟

در اینجا فهرستی از بسته‌هایی که از آخرین نسخه LFS به‌روزرسانی شده‌اند، آورده شده است:

- **Automake-1.17**
- **Bash-5.2.32**
- **Bc-6.7.6**
- **Binutils-2.43.1**
- **Coreutils-9.5**
- **E2fsprogs-1.47.1**
- **Expat-2.6.2**
- **Findutils-4.10.0**
- **GCC-14.2.0**
- **GDBM-1.24**
- **Gettext-0.22.5**
- **Glibc-2.40**
- **Iana-Etc-20240806**
- **IPRoute2-6.10.0**
- **Jinja2-3.1.4**
- **Kmod-33**
- **Less-661**
- **Libcap-2.70**
- **Libelf از Elfutils-0.191**
- **Libffi-3.4.6**
- **Linux-6.10.5**
- **Lz4-1.10.0**
- **Man-DB-2.12.1**
- **Man-pages-6.9.1**
- **Meson-1.5.1**
- **Ncurses-6.5**
- **Ninja-1.12.1**
- **OpenSSL-3.3.1**
- **Perl-5.40.0**
- **Pkgconf-2.3.0**
- **Psmisc-23.7**
- **Python-3.12.5**
- **Readline-8.2.13**
- **Setuptools-72.2.0**
- **Shadow-4.16.0**
- **Sysklogd-2.6.1**
- **Systemd-256.4**
- **SysVinit-3.10**
- **Tcl-8.6.14**
- **Udev از Systemd-256.4**
- **Util-linux-2.40.2**
- **Vim-9.1.0660**
- **Wheel-0.44.0**
- **Xz-5.6.2**
- **Zstd-1.5.6**

اضافه شده:
- **Lz4-1.10.0**

حذف شده:
- **bash-5.2.21-upstream_fixes-1.patch**
- **readline-8.2-upstream_fixes-3.patch**

---

### ۱.۳ تغییرات

این نسخه ۱۲.۲ از کتاب *Linux From Scratch* است که در تاریخ ۱ سپتامبر ۲۰۲۴ منتشر شده است. اگر این کتاب بیشتر از شش ماه قدمت دارد، به احتمال زیاد نسخه جدیدتری موجود است. برای بررسی نسخه جدیدتر، می‌توانید به یکی از آینه‌های سایت زیر مراجعه کنید:  
[https://www.linuxfromscratch.org/mirrors.html](https://www.linuxfromscratch.org/mirrors.html)


### 1.4. منابع

1.4.1. سؤالات متداول (FAQ)
اگر در طول ساخت سیستم LFS با هرگونه خطا مواجه شدید، سؤالی داشتید، یا فکر می‌کنید اشتباه تایپی در کتاب وجود دارد، لطفاً ابتدا به لیست سؤالات متداول (FAQ) که در https://www.linuxfromscratch.org/faq/ قرار دارد، مراجعه کنید.

### 1.4.2. لیست‌های پستی
سرور linuxfromscratch.org میزبان چندین لیست پستی است که برای توسعه پروژه LFS استفاده می‌شود. این لیست‌ها شامل لیست‌های اصلی توسعه و پشتیبانی، در میان موارد دیگر، هستند. اگر نمی‌توانید پاسخ مشکل خود را در صفحه FAQ پیدا کنید، قدم بعدی جستجو در لیست‌های پستی در https://www.linuxfromscratch.org/search.html خواهد بود.

برای اطلاعات در مورد لیست‌های مختلف، نحوه عضویت، مکان‌های آرشیو و اطلاعات اضافی، به https://www.linuxfromscratch.org/mail.html مراجعه کنید.

### 1.4.3. IRC
چندین عضو جامعه LFS از طریق چت رله اینترنتی (IRC) کمک ارائه می‌دهند. قبل از استفاده از این پشتیبانی، لطفاً مطمئن شوید که سؤال شما قبلاً در FAQ LFS یا آرشیو لیست پستی پاسخ داده نشده است. می‌توانید شبکه IRC را در irc.libera.chat پیدا کنید. کانال پشتیبانی #lfs-support نام دارد.

### 1.4.4. سایت‌های آینه
پروژه LFS تعدادی آینه جهانی دارد تا دسترسی به وب‌سایت و دانلود بسته‌های مورد نیاز راحت‌تر شود. لطفاً برای لیستی از آینه‌های فعلی به وب‌سایت LFS در https://www.linuxfromscratch.org/mirrors.html مراجعه کنید.

### 1.4.5. اطلاعات تماس
لطفاً تمام سؤالات و نظرات خود را به یکی از لیست‌های پستی LFS (به بالا مراجعه کنید) ارسال کنید.

### 1.5. کمک

```Text
نکته
در صورتی که با مشکلی در ساخت یک بسته با دستورالعمل LFS مواجه شده‌اید، ما قویاً توصیه می‌کنیم قبل از ارسال مستقیم مشکل به کانال پشتیبانی بالادستی، از طریق یکی از کانال‌های پشتیبانی LFS که در بخش 1.4، "منابع" ذکر شده است، بحث کنید. این کار اغلب ناکارآمد است زیرا نگهدارندگان بالادستی به ندرت با روش ساخت LFS آشنا هستند. حتی اگر واقعاً با یک مشکل بالادستی مواجه شده‌اید، جامعه LFS همچنان می‌تواند به جداسازی اطلاعات مورد نیاز توسط نگهدارندگان بالادستی کمک کند و یک گزارش مناسب تهیه کند.
```

اگر مجبور به پرسیدن سؤال مستقیماً از طریق یک کانال پشتیبانی بالادستی هستید، باید حداقل توجه داشته باشید که بسیاری از پروژه‌های بالادستی کانال‌های پشتیبانی را از ردیاب اشکال جدا کرده‌اند. گزارش‌های "باگ" برای پرسیدن سؤالات نامعتبر تلقی می‌شوند و ممکن است توسعه‌دهندگان بالادستی این پروژه‌ها را آزرده خاطر کنند.

اگر در حین کار با این کتاب با مشکل یا سؤالی مواجه شدید، لطفاً صفحه FAQ را در https://www.linuxfromscratch.org/faq/#generalfaq بررسی کنید. سؤالات اغلب در آنجا پاسخ داده شده‌اند. اگر پاسخ سؤال شما در آن صفحه نیست، سعی کنید منبع مشکل را پیدا کنید. راهنمای زیر برخی راهنمایی‌ها برای عیب‌یابی به شما ارائه می‌دهد: https://www.linuxfromscratch.org/hints/downloads/files/errors.txt.

اگر نمی‌توانید مشکل خود را در FAQ پیدا کنید، لیست‌های پستی را در https://www.linuxfromscratch.org/search.html جستجو کنید.

ما همچنین یک جامعه فوق‌العاده LFS داریم که مایل به ارائه کمک از طریق لیست‌های پستی و IRC است (به بخش 1.4، "منابع" این کتاب مراجعه کنید). با این حال، ما هر روز چندین سؤال پشتیبانی دریافت می‌کنیم و بسیاری از آنها می‌توانستند به راحتی با مراجعه به FAQ یا جستجو در لیست‌های پستی پاسخ داده شوند. بنابراین، برای اینکه ما بتوانیم بهترین کمک ممکن را ارائه دهیم، شما باید ابتدا خودتان کمی تحقیق کنید. این به ما اجازه می‌دهد تا روی نیازهای پشتیبانی غیرمعمول‌تر تمرکز کنیم. اگر جستجوهای شما راه حلی ارائه نکرد، لطفاً تمام اطلاعات مربوطه (که در زیر ذکر شده) را در درخواست کمک خود بگنجانید.

### 1.5.1. مواردی که باید ذکر شود

علاوه بر توضیح مختصری از مشکلی که تجربه می‌شود، هر درخواست کمک باید شامل این موارد ضروری باشد:

- نسخه کتاب مورد استفاده (در این مورد 12.2)
- توزیع میزبان و نسخه مورد استفاده برای ایجاد LFS
- خروجی از اسکریپت نیازمندی‌های سیستم میزبان
- بسته یا بخشی که مشکل در آن رخ داده است
- پیام خطای دقیق، یا توصیف واضحی از مشکل
- توجه داشته باشید که آیا از کتاب انحراف داشته‌اید یا خیر

```html
نکته
انحراف از این کتاب به این معنی نیست که ما به شما کمک نخواهیم کرد. در نهایت، LFS درباره ترجیح شخصی است. صادق بودن درباره هرگونه تغییر در روش ایجاد شده به ما کمک می‌کند تا علل احتمالی مشکل شما را ارزیابی و تعیین کنیم.
```

### ۱.۵.۲. مشکلات اسکریپت پیکربندی

اگر هنگام اجرای اسکریپت پیکربندی مشکلی پیش آمد، فایل `config.log` را بررسی کنید. این فایل ممکن است حاوی خطاهایی باشد که در طول پیکربندی رخ داده اما روی صفحه نمایش چاپ نشده‌اند. اگر نیاز به کمک دارید، خطوط مربوطه را در درخواست خود قرار دهید.

### ۱.۵.۳. مشکلات کامپایل

هم خروجی صفحه نمایش و هم محتوای فایل‌های مختلف در تعیین علت مشکلات کامپایل مفید هستند. خروجی صفحه نمایش از اسکریپت پیکربندی و اجرای `make` می‌تواند کمک‌کننده باشد. لازم نیست کل خروجی را شامل کنید، اما تمام اطلاعات مربوطه را قرار دهید. در اینجا نمونه‌ای از نوع اطلاعاتی که باید از خروجی صفحه `make` شامل شود، آورده شده است:
```bash
gcc -D ALIASPATH=\"/mnt/lfs/usr/share/locale:.\"
-D LOCALEDIR=\"/mnt/lfs/usr/share/locale\"
-D LIBDIR=\"/mnt/lfs/usr/lib\"
-D INCLUDEDIR=\"/mnt/lfs/usr/include\" -D HAVE_CONFIG_H -I. -I.
-g -O2 -c getopt1.c
gcc -g -O2 -static -o make ar.o arscan.o commands.o dir.o
expand.o file.o function.o getopt.o implicit.o job.o main.o
misc.o read.o remake.o rule.o signame.o variable.o vpath.o
default.o remote-stub.o version.o opt1.o
-lutil job.o: In function `load_too_high':
/lfs/tmp/make-3.79.1/job.c:1565: undefined reference
to `getloadavg'
collect2: ld returned 1 exit status
make[2]: *** [make] Error 1
make[2]: Leaving directory `/lfs/tmp/make-3.79.1'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/lfs/tmp/make-3.79.1'
make: *** [all-recursive-am] Error 2
```
در این مورد، بسیاری از افراد فقط بخش پایینی را شامل می‌کنند:
```bash
make [2]: *** [make] Error 1
```
این اطلاعات کافی برای تشخیص مشکل نیست، زیرا فقط نشان می‌دهد که مشکلی پیش آمده، نه اینکه چه مشکلی رخ داده است. کل بخش، مانند مثال بالا، باید ذخیره شود زیرا شامل دستوری است که اجرا شده و تمام پیام‌های خطای مربوطه را در بر می‌گیرد.

یک مقاله عالی درباره نحوه درخواست کمک در اینترنت به صورت آنلاین در آدرس http://catb.org/~esr/faqs/smart-questions.html در دسترس است. این سند را مطالعه کنید و نکات آن را دنبال کنید. انجام این کار احتمال دریافت کمک مورد نیاز شما را افزایش می‌دهد.