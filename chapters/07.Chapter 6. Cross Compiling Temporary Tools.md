# فصل ۶. کراس کامپایل ابزارهای موقت

## ۶.۱. مقدمه

این فصل نشان می‌دهد چگونه ابزارهای پایه را با استفاده از تولچین کراس کامپایلی که تازه ساخته شده است، کراس کامپایل کنیم. این ابزارها در مکان نهایی خود نصب می‌شوند، اما هنوز نمی‌توان از آنها استفاده کرد. وظایف اصلی همچنان به ابزارهای سیستم میزبان متکی هستند. با این حال، از کتابخانه‌های نصب شده هنگام لینک کردن استفاده می‌شود.

استفاده از این ابزارها در فصل بعد پس از ورود به محیط "chroot" امکان‌پذیر خواهد بود. اما تمام بسته‌هایی که در فصل حاضر ساخته می‌شوند باید قبل از انجام این کار ساخته شوند. بنابراین ما هنوز نمی‌توانیم از سیستم میزبان مستقل باشیم.

بار دیگر یادآوری می‌کنیم که تنظیم نادرست LFS همراه با ساخت به عنوان کاربر root، ممکن است کامپیوتر شما را غیرقابل استفاده کند. این فصل کامل باید به عنوان کاربر lfs، با محیطی که در بخش ۴.۴، "تنظیم محیط" توضیح داده شده است، انجام شود.

## ۶.۲. M4-1.4.19

بسته M4 شامل یک پردازشگر ماکرو است.

زمان تقریبی ساخت: ۰.۱ SBU
فضای دیسک مورد نیاز: ۳۱ مگابایت

### ۶.۲.۱. نصب M4

M4 را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr \
            --host=$LFS_TGT \
            --build=$(build-aux/config.guess)
```

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

جزئیات این بسته در بخش ۸.۱۳.۲، "محتویات M4" قرار دارد.

## ۶.۳. Ncurses-6.5

بسته Ncurses شامل کتابخانه‌هایی برای مدیریت صفحه‌های کاراکتری مستقل از ترمینال است.

زمان تقریبی ساخت: ۰.۴ SBU
فضای دیسک مورد نیاز: ۵۳ مگابایت

### ۶.۳.۱. نصب Ncurses

ابتدا، اطمینان حاصل کنید که gawk در طول پیکربندی اول پیدا می‌شود:

```bash
sed -i s/mawk// configure
```

سپس، دستورات زیر را برای ساخت برنامه "tic" در میزبان ساخت اجرا کنید:

```bash
mkdir build
pushd build
  ../configure
  make -C include
  make -C progs tic
popd
```

Ncurses را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr                \
            --host=$LFS_TGT              \
            --build=$(./config.guess)    \
            --mandir=/usr/share/man      \
            --with-manpage-format=normal \
            --with-shared                \
            --without-normal             \
            --with-cxx-shared            \
            --without-debug              \
            --without-ada                \
            --disable-stripping
```

معنای گزینه‌های جدید پیکربندی:

`--with-manpage-format=normal`

این از نصب صفحات راهنمای فشرده توسط Ncurses جلوگیری می‌کند، که ممکن است در صورتی که توزیع میزبان خود صفحات راهنمای فشرده داشته باشد، رخ دهد.

`--with-shared`

این باعث می‌شود Ncurses کتابخانه‌های مشترک C را بسازد و نصب کند.

`--without-normal`

این از ساخت و نصب کتابخانه‌های استاتیک C توسط Ncurses جلوگیری می‌کند.

`--without-debug`

این از ساخت و نصب کتابخانه‌های اشکال‌زدایی توسط Ncurses جلوگیری می‌کند.

`--with-cxx-shared`

این باعث می‌شود Ncurses پیوندهای مشترک ++C را بسازد و نصب کند. همچنین از ساخت و نصب پیوندهای استاتیک ++C جلوگیری می‌کند.

`--without-ada`

این اطمینان می‌دهد که Ncurses پشتیبانی برای کامپایلر Ada را نمی‌سازد، که ممکن است در میزبان موجود باشد اما پس از ورود به محیط chroot در دسترس نخواهد بود.

`--disable-stripping`

این سوئیچ از استفاده سیستم ساخت از برنامه strip میزبان جلوگیری می‌کند. استفاده از ابزارهای میزبان روی برنامه‌های کراس کامپایل شده ممکن است منجر به شکست شود.

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS TIC_PATH=$(pwd)/build/progs/tic install
ln -sv libncursesw.so $LFS/usr/lib/libncurses.so
sed -e 's/^#if.*XOPEN.*$/#if 1/' \
    -i $LFS/usr/include/curses.h
```

معنای گزینه‌های نصب:

`TIC_PATH=$(pwd)/build/progs/tic`

ما باید مسیر برنامه tic تازه ساخته شده را که روی ماشین سازنده اجرا می‌شود، ارسال کنیم تا پایگاه داده ترمینال بدون خطا ایجاد شود.

`ln -sv libncursesw.so $LFS/usr/lib/libncurses.so`

کتابخانه libncurses.so توسط چند بسته که به زودی خواهیم ساخت مورد نیاز است. ما این پیوند نمادین را برای استفاده از libncursesw.so به عنوان جایگزین ایجاد می‌کنیم.

`sed -e 's/^#if.*XOPEN.*$/#if 1/' ...`

فایل هدر curses.h حاوی تعریف ساختارهای داده مختلف Ncurses است. با تعاریف ماکروی پیش‌پردازنده مختلف، دو مجموعه متفاوت از تعریف ساختار داده می‌توانند استفاده شوند: تعریف ۸ بیتی با libncurses.so سازگار است و تعریف کاراکتر عریض با libncursesw.so سازگار است. از آنجایی که ما از libncursesw.so به عنوان جایگزین libncurses.so استفاده می‌کنیم، فایل هدر را ویرایش می‌کنیم تا همیشه از تعریف ساختار داده کاراکتر عریض سازگار با libncursesw.so استفاده کند.

جزئیات این بسته در بخش ۸.۳۰.۲، "محتویات Ncurses" قرار دارد.

## ۶.۴. Bash-5.2.32

بسته Bash شامل پوسته Bourne-Again است.

زمان تقریبی ساخت: ۰.۲ SBU
فضای دیسک مورد نیاز: ۶۷ مگابایت

### ۶.۴.۱. نصب Bash

Bash را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr                   \
            --build=$(sh support/config.guess) \
            --host=$LFS_TGT                 \
            --without-bash-malloc \
            bash_cv_strtold_broken=no
```

معنای گزینه‌های پیکربندی:

`--without-bash-malloc`

این گزینه استفاده از تابع تخصیص حافظه (malloc) Bash را که منجر به خطای قطعه‌بندی می‌شود، غیرفعال می‌کند. با غیرفعال کردن این گزینه، Bash از توابع malloc از Glibc استفاده خواهد کرد که پایدارتر هستند.

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

یک پیوند برای برنامه‌هایی که از sh برای پوسته استفاده می‌کنند ایجاد کنید:

```bash
ln -sv bash $LFS/bin/sh
```

جزئیات این بسته در بخش ۸.۳۶.۲، "محتویات Bash" قرار دارد.

## ۶.۵. Coreutils-9.5

بسته Coreutils شامل برنامه‌های ابزار پایه مورد نیاز هر سیستم عامل است.

زمان تقریبی ساخت: ۰.۳ SBU
فضای دیسک مورد نیاز: ۱۷۵ مگابایت

### ۶.۵.۱. نصب Coreutils

Coreutils را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr                     \
            --host=$LFS_TGT                   \
            --build=$(build-aux/config.guess) \
            --enable-install-program=hostname \
            --enable-no-install-program=kill,uptime
```

معنای گزینه‌های پیکربندی:

`--enable-install-program=hostname`

این باعث می‌شود باینری hostname ساخته و نصب شود - به طور پیش‌فرض غیرفعال است اما توسط مجموعه تست Perl مورد نیاز است.

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

برنامه‌ها را به مکان‌های نهایی مورد انتظارشان منتقل کنید. اگرچه این در این محیط موقت ضروری نیست، اما باید این کار را انجام دهیم زیرا برخی برنامه‌ها مکان‌های اجرایی را هارد کد می‌کنند:

```bash
mv -v $LFS/usr/bin/chroot $LFS/usr/sbin
mkdir -pv $LFS/usr/share/man/man8
mv -v $LFS/usr/share/man/man1/chroot.1 $LFS/usr/share/man/man8/chroot.8
sed -i 's/"1"/"8"/' $LFS/usr/share/man/man8/chroot.8
```

جزئیات این بسته در بخش ۸.۵۸.۲، "محتویات Coreutils" قرار دارد.

## ۶.۶. Diffutils-3.10

بسته Diffutils شامل برنامه‌هایی است که تفاوت‌های بین فایل‌ها یا دایرکتوری‌ها را نشان می‌دهند.

زمان تقریبی ساخت: ۰.۱ SBU
فضای دیسک مورد نیاز: ۲۹ مگابایت

### ۶.۶.۱. نصب Diffutils

Diffutils را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr \
            --host=$LFS_TGT \
            --build=$(./build-aux/config.guess)
```

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

جزئیات این بسته در بخش ۸.۶۰.۲، "محتویات Diffutils" قرار دارد.

## ۶.۷. File-5.45

بسته File شامل یک ابزار برای تعیین نوع فایل یا فایل‌های داده شده است.

زمان تقریبی ساخت: ۰.۱ SBU
فضای دیسک مورد نیاز: ۳۷ مگابایت

### ۶.۷.۱. نصب File

دستور file روی میزبان ساخت باید همان نسخه‌ای باشد که ما در حال ساخت آن هستیم تا بتواند فایل امضا را ایجاد کند. دستورات زیر را برای ایجاد یک کپی موقت از دستور file اجرا کنید:

```bash
mkdir build
pushd build
  ../configure --disable-bzlib      \
               --disable-libseccomp \
               --disable-xzlib      \
               --disable-zlib
  make
popd
```

معنای گزینه جدید پیکربندی:

`--disable-*`

اسکریپت پیکربندی تلاش می‌کند از برخی بسته‌های توزیع میزبان استفاده کند اگر فایل‌های کتابخانه مربوطه وجود داشته باشند. این ممکن است باعث شکست کامپایل شود اگر یک فایل کتابخانه وجود داشته باشد، اما فایل‌های هدر مربوطه وجود نداشته باشند. این گزینه‌ها از استفاده از این قابلیت‌های غیر ضروری از میزبان جلوگیری می‌کنند.

File را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr --host=$LFS_TGT --build=$(./config.guess)
```

بسته را کامپایل کنید:

```bash
make FILE_COMPILE=$(pwd)/build/src/file
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

فایل آرشیو libtool را حذف کنید زیرا برای کراس کامپایل مضر است:

```bash
rm -v $LFS/usr/lib/libmagic.la
```

جزئیات این بسته در بخش ۸.۱۱.۲، "محتویات File" قرار دارد.

## ۶.۸. Findutils-4.10.0

بسته Findutils شامل برنامه‌هایی برای یافتن فایل‌ها است. برنامه‌هایی برای جستجو در تمام فایل‌های یک درخت دایرکتوری و ایجاد، نگهداری و جستجو در یک پایگاه داده (اغلب سریع‌تر از جستجوی بازگشتی، اما غیرقابل اعتماد مگر اینکه پایگاه داده اخیراً به‌روز شده باشد) ارائه شده است. Findutils همچنین برنامه xargs را ارائه می‌دهد که می‌تواند برای اجرای یک دستور مشخص روی هر فایل انتخاب شده توسط یک جستجو استفاده شود.

زمان تقریبی ساخت: ۰.۲ SBU
فضای دیسک مورد نیاز: ۴۸ مگابایت

### ۶.۸.۱. نصب Findutils

Findutils را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr                   \
            --localstatedir=/var/lib/locate \
            --host=$LFS_TGT                 \
            --build=$(build-aux/config.guess)
```

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

جزئیات این بسته در بخش ۸.۶۲.۲، "محتویات Findutils" قرار دارد.

## ۶.۹. Gawk-5.3.0

بسته Gawk شامل برنامه‌هایی برای دستکاری فایل‌های متنی است.

زمان تقریبی ساخت: ۰.۱ SBU
فضای دیسک مورد نیاز: ۴۷ مگابایت

### ۶.۹.۱. نصب Gawk

ابتدا، اطمینان حاصل کنید که برخی فایل‌های غیر ضروری نصب نمی‌شوند:

```bash
sed -i 's/extras//' Makefile.in
```

Gawk را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr   \
            --host=$LFS_TGT \
            --build=$(build-aux/config.guess)
```

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

جزئیات این بسته در بخش ۸.۶۱.۲، "محتویات Gawk" قرار دارد.

## ۶.۱۰. Grep-3.11

بسته Grep شامل برنامه‌هایی برای جستجو در محتویات فایل‌ها است.

زمان تقریبی ساخت: ۰.۱ SBU
فضای دیسک مورد نیاز: ۲۷ مگابایت

### ۶.۱۰.۱. نصب Grep

Grep را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr   \
            --host=$LFS_TGT \
            --build=$(./build-aux/config.guess)
```

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

جزئیات این بسته در بخش ۸.۳۵.۲، "محتویات Grep" قرار دارد.

## ۶.۱۱. Gzip-1.13

بسته Gzip شامل برنامه‌هایی برای فشرده‌سازی و از فشرده خارج کردن فایل‌ها است.

زمان تقریبی ساخت: ۰.۱ SBU
فضای دیسک مورد نیاز: ۱۱ مگابایت

### ۶.۱۱.۱. نصب Gzip

Gzip را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr --host=$LFS_TGT
```

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

جزئیات این بسته در بخش ۸.۶۵.۲، "محتویات Gzip" قرار دارد.

## ۶.۱۲. Make-4.4.1

بسته Make شامل برنامه‌ای برای کنترل تولید فایل‌های اجرایی و سایر فایل‌های غیر منبع یک بسته از فایل‌های منبع است.

زمان تقریبی ساخت: کمتر از ۰.۱ SBU
فضای دیسک مورد نیاز: ۱۵ مگابایت

### ۶.۱۲.۱. نصب Make

Make را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr   \
            --without-guile \
            --host=$LFS_TGT \
            --build=$(build-aux/config.guess)
```

معنای گزینه جدید پیکربندی:

`--without-guile`

اگرچه ما در حال کراس کامپایل هستیم، configure سعی می‌کند از guile میزبان ساخت استفاده کند اگر آن را پیدا کند. این باعث شکست کامپایل می‌شود، بنابراین این سوئیچ از استفاده از آن جلوگیری می‌کند.

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

جزئیات این بسته در بخش ۸.۶۹.۲، "محتویات Make" قرار دارد.

## ۶.۱۳. Patch-2.7.6

بسته Patch شامل برنامه‌ای برای اصلاح یا ایجاد فایل‌ها با اعمال یک فایل "patch" است که معمولاً توسط برنامه diff ایجاد می‌شود.

زمان تقریبی ساخت: ۰.۱ SBU
فضای دیسک مورد نیاز: ۱۲ مگابایت

### ۶.۱۳.۱. نصب Patch

Patch را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr   \
            --host=$LFS_TGT \
            --build=$(build-aux/config.guess)
```

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

جزئیات این بسته در بخش ۸.۷۰.۲، "محتویات Patch" قرار دارد.

## ۶.۱۴. Sed-4.9

بسته Sed شامل یک ویرایشگر جریان است.

زمان تقریبی ساخت: ۰.۱ SBU
فضای دیسک مورد نیاز: ۲۱ مگابایت

### ۶.۱۴.۱. نصب Sed

Sed را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr   \
            --host=$LFS_TGT \
            --build=$(./build-aux/config.guess)
```

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

جزئیات این بسته در بخش ۸.۳۱.۲، "محتویات Sed" قرار دارد.

## ۶.۱۵. Tar-1.35

بسته Tar قابلیت ایجاد آرشیوهای tar و همچنین انجام انواع دیگر دستکاری آرشیو را فراهم می‌کند. Tar می‌تواند برای استخراج فایل‌ها، ذخیره فایل‌های اضافی، یا به‌روزرسانی یا لیست کردن فایل‌هایی که قبلاً ذخیره شده‌اند، روی آرشیوهای ایجاد شده قبلی استفاده شود.

زمان تقریبی ساخت: ۰.۱ SBU
فضای دیسک مورد نیاز: ۴۲ مگابایت

### ۶.۱۵.۱. نصب Tar

Tar را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr   \
            --host=$LFS_TGT \
            --build=$(build-aux/config.guess)
```

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

جزئیات این بسته در بخش ۸.۷۱.۲، "محتویات Tar" قرار دارد.

## ۶.۱۶. Xz-5.6.2

بسته Xz شامل برنامه‌هایی برای فشرده‌سازی و از فشرده خارج کردن فایل‌ها است. این بسته قابلیت‌هایی برای فرمت‌های فشرده‌سازی lzma و xz جدیدتر را فراهم می‌کند. فشرده‌سازی فایل‌های متنی با xz درصد فشرده‌سازی بهتری نسبت به دستورات سنتی gzip یا bzip2 ارائه می‌دهد.

زمان تقریبی ساخت: ۰.۱ SBU
فضای دیسک مورد نیاز: ۲۰ مگابایت

### ۶.۱۶.۱. نصب Xz

Xz را برای کامپایل آماده کنید:

```bash
./configure --prefix=/usr                     \
            --host=$LFS_TGT                   \
            --build=$(build-aux/config.guess) \
            --disable-static                  \
            --docdir=/usr/share/doc/xz-5.6.2
```

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

فایل آرشیو libtool را حذف کنید زیرا برای کراس کامپایل مضر است:

```bash
rm -v $LFS/usr/lib/liblzma.la
```

جزئیات این بسته در بخش ۸.۸.۲، "محتویات Xz" قرار دارد.

## ۶.۱۷. Binutils-2.43.1 - گذر ۲

بسته Binutils شامل یک لینکر، یک اسمبلر و سایر ابزارها برای کار با فایل‌های شیء است.

زمان تقریبی ساخت: ۰.۴ SBU
فضای دیسک مورد نیاز: ۵۴۹ مگابایت

### ۶.۱۷.۱. نصب Binutils

سیستم ساخت Binutils به یک نسخه ارسال شده از libtool برای لینک با کتابخانه‌های استاتیک داخلی متکی است، اما نسخه‌های libiberty و zlib ارسال شده در بسته از libtool استفاده نمی‌کنند. این ناسازگاری ممکن است باعث شود باینری‌های تولید شده به اشتباه به کتابخانه‌های توزیع میزبان لینک شوند. برای رفع این مشکل:

```bash
sed '6009s/$add_dir//' -i ltmain.sh
```

مجدداً یک دایرکتوری ساخت جداگانه ایجاد کنید:

```bash
mkdir -v build
cd build
```

Binutils را برای کامپایل آماده کنید:

```bash
../configure                   \
    --prefix=/usr              \
    --build=$(../config.guess) \
    --host=$LFS_TGT            \
    --disable-nls              \
    --enable-shared            \
    --enable-gprofng=no        \
    --disable-werror           \
    --enable-64-bit-bfd        \
    --enable-new-dtags         \
    --enable-default-hash-style=gnu
```

معنای گزینه‌های جدید پیکربندی:

`--enable-shared`
libbfd را به عنوان یک کتابخانه مشترک می‌سازد.

`--enable-64-bit-bfd`
پشتیبانی ۶۴ بیتی را فعال می‌کند (در میزبان‌هایی با اندازه کلمه کوچکتر). این ممکن است در سیستم‌های ۶۴ بیتی لازم نباشد، اما ضرری ندارد.

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

فایل‌های آرشیو libtool را حذف کنید زیرا برای کراس کامپایل مضر هستند، و کتابخانه‌های استاتیک غیر ضروری را حذف کنید:

```bash
rm -v $LFS/usr/lib/lib{bfd,ctf,ctf-nobfd,opcodes,sframe}.{a,la}
```

جزئیات این بسته در بخش ۸.۲۰.۲، "محتویات Binutils" قرار دارد.

## ۶.۱۸. GCC-14.2.0 - گذر ۲

بسته GCC شامل مجموعه کامپایلر GNU است، که شامل کامپایلرهای C و ++C می‌شود.

زمان تقریبی ساخت: ۴.۲ SBU
فضای دیسک مورد نیاز: ۵.۵ گیگابایت

### ۶.۱۸.۱. نصب GCC

همانند ساخت اول GCC، بسته‌های GMP، MPFR و MPC مورد نیاز هستند. تارباال را باز کنید و آنها را به دایرکتوری‌های مورد نیاز منتقل کنید:

```bash
tar -xf ../mpfr-4.2.1.tar.xz
mv -v mpfr-4.2.1 mpfr
tar -xf ../gmp-6.3.0.tar.xz
mv -v gmp-6.3.0 gmp
tar -xf ../mpc-1.3.1.tar.gz
mv -v mpc-1.3.1 mpc
```

اگر روی x86_64 ساخت می‌کنید، نام پیش‌فرض دایرکتوری برای کتابخانه‌های ۶۴ بیتی را به "lib" تغییر دهید:

```bash
case $(uname -m) in
  x86_64)
    sed -e '/m64=/s/lib64/lib/' \
        -i.orig gcc/config/i386/t-linux64
  ;;
esac
```

قانون ساخت هدرهای libgcc و libstdc++ را لغو کنید تا اجازه ساخت این کتابخانه‌ها با پشتیبانی از رشته‌های POSIX را بدهد:

```bash
sed '/thread_header =/s/@.*@/gthr-posix.h/' \
    -i libgcc/Makefile.in libstdc++-v3/include/Makefile.in
```

مجدداً یک دایرکتوری ساخت جداگانه ایجاد کنید:

```bash
mkdir -v build
cd build
```

قبل از شروع ساخت GCC، به یاد داشته باشید که هر متغیر محیطی که پرچم‌های بهینه‌سازی پیش‌فرض را لغو می‌کند، پاک کنید.

حالا GCC را برای کامپایل آماده کنید:

```bash
../configure                                       \
    --build=$(../config.guess)                     \
    --host=$LFS_TGT                                \
    --target=$LFS_TGT                              \
    LDFLAGS_FOR_TARGET=-L$PWD/$LFS_TGT/libgcc      \
    --prefix=/usr                                  \
    --with-build-sysroot=$LFS                      \
    --enable-default-pie                           \
    --enable-default-ssp                           \
    --disable-nls                                  \
    --disable-multilib                             \
    --disable-libatomic                            \
    --disable-libgomp                              \
    --disable-libquadmath                          \
    --disable-libsanitizer                         \
    --disable-libssp                               \
    --disable-libvtv                               \
    --enable-languages=c,c++
```

معنای گزینه‌های جدید پیکربندی:

`--with-build-sysroot=$LFS`

معمولاً، استفاده از --host اطمینان می‌دهد که یک کراس کامپایلر برای ساخت GCC استفاده می‌شود، و آن کامپایلر می‌داند که باید به دنبال هدرها و کتابخانه‌ها در $LFS بگردد. اما سیستم ساخت GCC از ابزارهای دیگری استفاده می‌کند که از این مکان آگاه نیستند. این سوئیچ لازم است تا آن ابزارها فایل‌های مورد نیاز را در $LFS پیدا کنند و نه در میزبان.

`--target=$LFS_TGT`

ما در حال کراس کامپایل GCC هستیم، بنابراین غیرممکن است که کتابخانه‌های هدف (libgcc و libstdc++) را با باینری‌های GCC کامپایل شده در این گذر بسازیم—آن باینری‌ها روی میزبان اجرا نخواهند شد. سیستم ساخت GCC به طور پیش‌فرض تلاش خواهد کرد از کامپایلرهای C و ++C میزبان به عنوان یک راه حل جایگزین استفاده کند. ساخت کتابخانه‌های هدف GCC با یک نسخه متفاوت از GCC پشتیبانی نمی‌شود، بنابراین استفاده از کامپایلرهای میزبان ممکن است باعث شکست ساخت شود. این پارامتر اطمینان می‌دهد که کتابخانه‌ها توسط GCC گذر ۱ ساخته می‌شوند.

`LDFLAGS_FOR_TARGET=...`

به libstdc++ اجازه می‌دهد از libgcc که در این گذر ساخته می‌شود استفاده کند، به جای نسخه قبلی که در gcc-pass1 ساخته شده است. نسخه قبلی نمی‌تواند به درستی از مدیریت استثنای ++C پشتیبانی کند زیرا بدون پشتیبانی libc ساخته شده است.

`--disable-libsanitizer`

کتابخانه‌های زمان اجرای GCC sanitizer را غیرفعال می‌کند. آنها برای نصب موقت مورد نیاز نیستند. در gcc-pass1 این با --disable-libstdcxx ضمنی بود و اکنون می‌توانیم آن را به صراحت ارسال کنیم.

بسته را کامپایل کنید:

```bash
make
```

بسته را نصب کنید:

```bash
make DESTDIR=$LFS install
```

به عنوان یک پایان کار، یک پیوند نمادین ابزار ایجاد کنید. بسیاری از برنامه‌ها و اسکریپت‌ها cc را به جای gcc اجرا می‌کنند، که برای حفظ عمومیت برنامه‌ها و در نتیجه قابل استفاده بودن در تمام انواع سیستم‌های UNIX که کامپایلر GNU C همیشه نصب نیست، استفاده می‌شود. اجرای cc به مدیر سیستم این آزادی را می‌دهد که تصمیم بگیرد کدام کامپایلر C را نصب کند:

```
ln -sv gcc $LFS/usr/bin/cc
```

جزئیات این بسته در بخش ۸.۲۹.۲، "محتویات GCC" قرار دارد.